import{$ as a,Ea as p,Fa as O,Nc as R,U as x,Uc as S,V as y,Vc as _,W as o,Y as E,aa as j,fa as I,gb as D,ib as C,pa as d,qa as m,ra as P,va as s,xa as g}from"./chunk-RU6JGEEY.js";import"./chunk-KD7LYDAI.js";import{g as U}from"./chunk-WTI2L5DI.js";function N(e,r){e&1&&(d(0,"div")(1,"p",2),p(2,"Caricamento scheda in corso..."),m()())}function z(e,r){if(e&1&&(d(0,"div",3)(1,"p",4),p(2),m()()),e&2){let c=g();o(2),O(c.error)}}function A(e,r){if(e&1&&(d(0,"div"),P(1,"iframe",5),d(2,"p",6)(3,"a",7),p(4," Scarica il PDF "),m()()()),e&2){let c=g();o(),s("src",c.safePdfUrl,y),o(2),s("href",c.pdfObjectUrl,x)}}var q=(()=>{let r=class r{constructor(n,i,t,l){this.route=n,this.firestore=i,this.ngZone=t,this.sanitizer=l,this.loading=!0,this.error=null}ngOnInit(){return U(this,null,function*(){let n=this.route.snapshot.paramMap.get("userId"),i=Number(this.route.snapshot.paramMap.get("cardIndex"));if(!n||Number.isNaN(i)){this.setError("Link non valido: dati mancanti.");return}try{let t=S(this.firestore,`users/${n}`),l=yield _(t);if(!l.exists()){this.setError("Utente non trovato.");return}let h=l.data().cards?.[i];if(!h){this.setError("Scheda non trovata.");return}if(!h.pdfBase64){this.setError("Scheda PDF non disponibile.");return}let u=atob(h.pdfBase64),b=new Array(u.length);for(let f=0;f<u.length;f++)b[f]=u.charCodeAt(f);let w=new Uint8Array(b),L=new Blob([w],{type:"application/pdf"}),v=URL.createObjectURL(L);this.ngZone.run(()=>{this.pdfObjectUrl=v,this.safePdfUrl=this.sanitizer.bypassSecurityTrustResourceUrl(v),this.loading=!1,this.error=null})}catch{this.setError("Errore di caricamento dati.")}})}ngOnDestroy(){this.pdfObjectUrl&&(URL.revokeObjectURL(this.pdfObjectUrl),this.pdfObjectUrl=void 0)}setError(n){this.loading=!1,this.error=n,this.safePdfUrl=void 0,this.pdfObjectUrl&&(URL.revokeObjectURL(this.pdfObjectUrl),this.pdfObjectUrl=void 0)}};r.\u0275fac=function(i){return new(i||r)(a(C),a(R),a(E),a(D))},r.\u0275cmp=j({type:r,selectors:[["app-user-detail-public"]],decls:3,vars:3,consts:[[4,"ngIf"],["class","error-message",4,"ngIf"],[2,"text-align","center"],[1,"error-message"],[2,"color","#b71c1c","text-align","center","font-weight","500"],["width","100%","height","700px",2,"border","none",3,"src"],[2,"text-align","center","margin-top","20px"],["download","scheda-allenamento.pdf","target","_blank",2,"text-decoration","underline",3,"href"]],template:function(i,t){i&1&&I(0,N,3,0,"div",0)(1,z,3,1,"div",1)(2,A,5,2,"div",0),i&2&&(s("ngIf",t.loading),o(),s("ngIf",!t.loading&&t.error),o(),s("ngIf",!t.loading&&!t.error&&t.safePdfUrl))},styles:["iframe[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 18px #0001}"]});let e=r;return e})();export{q as UserDetailPublicComponent};
